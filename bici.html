<html>
	<head>
		<title>Load OBJ File</title>
		<style>
		body {
			font-family: Monospace;
			background-color: #f0f0f0;
			margin: 0px;
			overflow: hidden;
		}

		canvas {
			width: 100%;
			height: 100%;
		}
		</style>
		<script src="lib/three.min.js"></script>
		<script src="lib/stats.min.js"></script>
		<script src="lib/GLTFLoader.js"></script>
		<script src="lib/OrbitControls.js"></script>
		</head>
	<body>

		<script>

			var scene, renderer, camera, stats;

			function Start()
      {
				scene = new THREE.Scene();
				camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
				renderer = new THREE.WebGLRenderer();
				renderer.setSize( window.innerWidth, window.innerHeight );
				renderer.setClearColor( 0xf0f0f0 );
				document.body.appendChild( renderer.domElement );

				controls = new THREE.OrbitControls(camera);
				controls.addEventListener( 'change', Render );

				var loader = new THREE.GLTFLoader();

				//light
				var light = new THREE.PointLight( 0xffffff, 1,0 );
				var lightAmbientale = new THREE.AmbientLight( 0x404040 );
				light.position.set(0,0,0);
				light.castShadow =true;

				stats = new Stats();
				stats.domElement.style.position = 'absolute';
				stats.domElement.style.top = '0px';
				document.body.appendChild( stats.domElement );

				//THREE.DRACOLoader.setDecoderPath( '/examples/js/libs/draco' );
				//loader.setDRACOLoader( new THREE.DRACOLoader() );
				// Load a glTF resource
				 loader.load(
				 	// resource URL
				 	'object/scene.gltf',
				 	// called when the resource is loaded
					function ( gltf ) {

						scene.add( gltf.scene );

						gltf.animations; // Array<THREE.AnimationClip>
						gltf.scene; // THREE.Scene
						gltf.scenes; // Array<THREE.Scene>
						gltf.cameras; // Array<THREE.Camera>
						gltf.asset; // Object

					},
					// called when loading is in progresses
					function ( xhr ) {

						console.log( ( xhr.loaded / xhr.total * 100 ) + '% loaded' );

					},
					// called when loading has errors
					function ( error ) {
						console.log(error);
						console.log( 'An error happened' );

					}
				);

				light.position.set(0,500,0);
				var bici = creaBici(1);
				scene.add(bici,light,lightAmbientale);
				camera.position.z = 10;
        }


			function Render()
      {
				   requestAnimationFrame(Render);
			     stats.update();
					 //controls.update();
				   renderer.render(scene, camera);
			}

			function creaBici(mul)
			{
				//TODO
				var pivotBici = new THREE.Object3D();
				var telaio = creaTelaio(0xff0000,mul);
				var ruotaDietro = creaRuota(3.5,0x000000,mul);
				var ruotaDavanti = creaRuota(3.5,0x000000,mul);
				ruotaDietro.position.set(0,5,8.4);
				ruotaDietro.rotation.set(0,Math.PI*90/180,0);
				ruotaDavanti.position.set(0,5,-5);
				ruotaDavanti.rotation.set(0,Math.PI*90/180,0);
				pivotBici.add(telaio,ruotaDietro,ruotaDavanti);
				return pivotBici;
			}

			function creaTelaio(colore,mul,image)
			{
				var pivotTelaio = new THREE.Object3D();
				var geometryDietro1 = new THREE.CylinderGeometry( 0.05*mul, 0.05*mul, 5.6*mul, 32 );
				var geometryDietro2 = new THREE.CylinderGeometry( 0.05*mul, 0.05*mul, 4.75*mul, 32 );
				var geometryInMezzo1 = new THREE.CylinderGeometry( 0.2*mul, 0.2*mul, 10*mul, 32 );
				var geometryInMezzo2 = new THREE.CylinderGeometry( 0.2*mul, 0.2*mul, 10.3*mul, 32 );
				var geometryInMezzo3 = new THREE.CylinderGeometry( 0.2*mul, 0.2*mul, 6*mul, 32 );
				var geometryInMezzo4 = new THREE.CylinderGeometry( 0.2*mul, 0.2*mul, 2*mul, 32 );
				var geometryDavanti1 = new THREE.CylinderGeometry( 0.3*mul, 0.2*mul, 2*mul, 32 );
				var geometryDavanti2 = new THREE.CylinderGeometry( 0.05*mul, 0.05*mul, 4*mul, 32 );
				var geometryDavanti3 = new THREE.CylinderGeometry( 0.2*mul, 0.2*mul, 0.5*mul, 32 );
				var texture = new THREE.TextureLoader().load( image);
				var material;
				if(image==undefined){
						material = new THREE.MeshLambertMaterial({color:colore});
				}
				else{
					material = new THREE.MeshLambertMaterial({map:texture});
				}
				var cylinder1 = new THREE.Mesh( geometryInMezzo1, material );
				var cylinder2 = new THREE.Mesh( geometryInMezzo2, material );
				var cylinder3 = new THREE.Mesh( geometryInMezzo3, material );
				var cylinder4 = new THREE.Mesh( geometryInMezzo4, material );
				var cylinder5 = new THREE.Mesh( geometryDietro1, material );
				var cylinder6 = new THREE.Mesh( geometryDietro1, material );
				var cylinder7 = new THREE.Mesh( geometryDietro2, material );
				var cylinder8 = new THREE.Mesh( geometryDietro2, material );
				var cylinder9 = new THREE.Mesh( geometryDavanti1, material );
				var cylinder10 = new THREE.Mesh( geometryDavanti3, material );
				var cylinder11 = new THREE.Mesh( geometryDavanti2, material );
				var cylinder12 = new THREE.Mesh( geometryDavanti2, material );
				cylinder1.position.set(0,10*mul,0);
				cylinder1.rotation.set(Math.PI*90/180,0,0);
				cylinder2.position.set(0,7.3*mul,-0.6*mul);
				cylinder2.rotation.set(Math.PI*120/180,0,0);
				cylinder3.position.set(0,7.5*mul,4.5*mul);
				cylinder3.rotation.set(Math.PI*10/180,0,0);
				cylinder4.position.set(0,10.9*mul,5*mul);
				cylinder5.position.set(0.1*mul,7*mul,6.7*mul);
				cylinder5.rotation.set(Math.PI*315/180,0,0);
				cylinder6.position.set(-0.1*mul,7*mul,6.7*mul);
				cylinder6.rotation.set(Math.PI*315/180,0,0);
				cylinder7.position.set(0.1*mul,5*mul,6.4*mul);
				cylinder7.rotation.set(Math.PI*90/180,0,0);
				cylinder8.position.set(-0.1*mul,5*mul,6.4*mul);
				cylinder8.rotation.set(Math.PI*90/180,0,0);
				cylinder9.position.set(0,10*mul,-5*mul);
				cylinder10.position.set(0,9*mul,-5*mul);
				cylinder10.rotation.set(Math.PI*90/180,0,Math.PI*90/180);
				cylinder11.position.set(0.1*mul,7*mul,-5*mul);
				cylinder12.position.set(-0.1*mul,7*mul,-5*mul);
				pivotTelaio.add(cylinder1,cylinder2,cylinder3,cylinder4,cylinder5,cylinder6,
												cylinder7,cylinder8,cylinder9,cylinder10,cylinder11,
												cylinder12);
				return pivotTelaio;
			}


			function creaRuota(ray,colore,mul,image)
			{
				//ray max= 3.5
				//TODO
				var pivotRuota = new THREE.Object3D();
				var geometryGomma = new THREE.TorusGeometry( ray, 0.05, 16, 100 );
				var geometryRaggio = new THREE.CubeGeometry(0.01,0.3,ray);
				var geometryCerchione = new THREE.TorusGeometry( ray-0.05, 0.05, 16, 100 );
				var geometryCerchione1 = new THREE.TorusGeometry( ray-0.10, 0.05, 16, 100 );
				var geometryCerchione2 = new THREE.TorusGeometry( ray-0.15, 0.05, 16, 100 );
				var texture = new THREE.TextureLoader().load( image);
				var materialGomma,materialCerchione,materialRaggio;
				materialCerchione = new THREE.MeshLambertMaterial({color:0xffff00});
				materialRaggio = new THREE.MeshLambertMaterial({color:0x111111});
				if(image==undefined){
						materialGomma = new THREE.MeshLambertMaterial({color:colore});
				}
				else{
					materialGomma = new THREE.MeshLambertMaterial({map:texture});
					materialCerchione = new THREE.MeshLambertMaterial({map:texture});
				}
				var gomma = new THREE.Mesh( geometryGomma, materialGomma );
				var cerchione = new THREE.Mesh(geometryCerchione,materialCerchione);
				var cerchione1 = new THREE.Mesh(geometryCerchione1,materialCerchione);
				var cerchione2 = new THREE.Mesh(geometryCerchione2,materialCerchione);
				var raggio1 = new THREE.Mesh(geometryRaggio,materialRaggio);
				var raggio2 = new THREE.Mesh(geometryRaggio,materialRaggio);
				var raggio3 = new THREE.Mesh(geometryRaggio,materialRaggio);
				var raggio4 = new THREE.Mesh(geometryRaggio,materialRaggio);
				var raggio5 = new THREE.Mesh(geometryRaggio,materialRaggio);
				var pivotRaggio1 = new THREE.Object3D();
				var pivotRaggio2 = new THREE.Object3D();
				var pivotRaggio3 = new THREE.Object3D();
				var pivotRaggio4 = new THREE.Object3D();
				var pivotRaggio5 = new THREE.Object3D();
				raggio1.position.set(0,ray/2,0);
				raggio1.rotation.set(Math.PI*90/180,0,Math.PI*90/180);
				raggio2.position.set(0,ray/2,0);
				raggio2.rotation.set(Math.PI*90/180,0,Math.PI*90/180);
				pivotRaggio2.rotation.set(0,0,Math.PI*72/180);
				raggio3.position.set(0,ray/2,0);
				raggio3.rotation.set(Math.PI*90/180,0,Math.PI*90/180);
				pivotRaggio3.rotation.set(0,0,Math.PI*144/180);
				raggio4.position.set(0,ray/2,0);
				raggio4.rotation.set(Math.PI*90/180,0,Math.PI*90/180);
				pivotRaggio4.rotation.set(0,0,Math.PI*216/180);
				raggio5.position.set(0,ray/2,0);
				raggio5.rotation.set(Math.PI*90/180,0,Math.PI*90/180);
				pivotRaggio5.rotation.set(0,0,Math.PI*288/180);
				pivotRaggio2.add(raggio2);
				pivotRaggio3.add(raggio3);
				pivotRaggio4.add(raggio4);
				pivotRaggio5.add(raggio5);
				pivotRuota.add( gomma,cerchione,cerchione1,cerchione2,raggio1,pivotRaggio2,pivotRaggio3,pivotRaggio4,pivotRaggio5 );
				return pivotRuota;
			}

			function creaManubrio()
			{
				//TODO
			}

			function creaPedali()
			{
				//TODO
			}

			function creaCatena()
			{
				//TODO
			}

			function creaFanale()
			{
				//TODO
				//latheGeometry
			}

			function creaSellino()
			{
				//TODO
			}

			Start();
			Render();
		</script>
	</body>
</html>
